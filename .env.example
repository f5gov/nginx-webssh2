# NGINX + WebSSH2 Container Configuration
# Copy this file to .env and customize for your environment

# =============================================================================
# TLS/SSL Configuration
# =============================================================================

# TLS Mode: self-signed, provided, letsencrypt
TLS_MODE=self-signed

# TLS Certificate Paths (for provided mode)
TLS_CERT_PATH=/etc/nginx/certs/cert.pem
TLS_KEY_PATH=/etc/nginx/certs/key.pem
TLS_CHAIN_PATH=/etc/nginx/certs/chain.pem

# TLS Certificate Content (alternative to file paths)
# TLS_CERT_CONTENT="-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
# TLS_KEY_CONTENT="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
# TLS_CHAIN_CONTENT="-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"

# TLS Protocols and Ciphers
TLS_PROTOCOLS=TLSv1.2 TLSv1.3
TLS_CIPHERS=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-GCM-SHA256

# Self-signed Certificate Configuration
TLS_CERT_CN=webssh2.localhost
TLS_CERT_SAN=webssh2.localhost,localhost,127.0.0.1
TLS_CERT_COUNTRY=US
TLS_CERT_STATE=CA
TLS_CERT_CITY=San Francisco
TLS_CERT_ORG=WebSSH2
TLS_CERT_OU=WebSSH2 Container
TLS_CERT_DAYS=365
TLS_CERT_BITS=2048
TLS_DH_SIZE=2048

# =============================================================================
# Mutual TLS (mTLS) Configuration
# =============================================================================

# Enable mutual TLS authentication
MTLS_ENABLED=false

# Client certificate verification
MTLS_CA_CERT=/etc/nginx/certs/ca.pem
MTLS_VERIFY_DEPTH=2
MTLS_CRL_PATH=/etc/nginx/certs/crl.pem
MTLS_OPTIONAL=false

# =============================================================================
# FIPS 140-2 Configuration
# =============================================================================

# FIPS Mode: enabled, disabled
FIPS_MODE=enabled

# Strict FIPS checking (set to false for development)
FIPS_CHECK=true

# =============================================================================
# NGINX Configuration
# =============================================================================

# Listen Port (HTTPS only)
NGINX_LISTEN_PORT=443

# Server Configuration
NGINX_SERVER_NAME=webssh2.localhost
NGINX_WORKER_PROCESSES=auto
NGINX_WORKER_CONNECTIONS=1024
NGINX_KEEPALIVE_TIMEOUT=65

# Client Settings
NGINX_CLIENT_MAX_BODY_SIZE=1m

# Proxy Timeouts (important for long SSH sessions)
NGINX_PROXY_READ_TIMEOUT=3600s
NGINX_PROXY_SEND_TIMEOUT=3600s

# Rate Limiting
NGINX_RATE_LIMIT=10r/s
NGINX_RATE_LIMIT_BURST=20
NGINX_CONN_LIMIT=100

# Compression
NGINX_GZIP=on

# Logging Configuration
# NGINX_ACCESS_LOG: Enable/disable NGINX access logging
#   - 'off' (default): Disabled for better performance, less disk I/O
#   - 'on': Enable detailed access logging to /var/log/nginx/access.log
NGINX_ACCESS_LOG=off

# NGINX_ERROR_LOG_LEVEL: Control NGINX error log verbosity
#   Options: debug, info, notice, warn (default), error, crit, alert, emerg
NGINX_ERROR_LOG_LEVEL=warn

# =============================================================================
# Security Headers
# =============================================================================

# Enable security headers
SECURITY_HEADERS=true

# HTTP Strict Transport Security
HSTS_MAX_AGE=31536000

# Content Security Policy
CSP_POLICY=default-src 'self'; script-src 'self' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss:; font-src 'self'; img-src 'self' data:;

# =============================================================================
# WebSSH2 Core Configuration
# =============================================================================

# WebSSH2 Listen Address (should be 127.0.0.1 for reverse proxy setup)
WEBSSH2_LISTEN_IP=127.0.0.1
WEBSSH2_LISTEN_PORT=2222

# =============================================================================
# WebSSH2 SSH Configuration
# =============================================================================

# Default SSH target (leave empty for dynamic selection)
WEBSSH2_SSH_HOST=
WEBSSH2_SSH_PORT=22

# Terminal Configuration
WEBSSH2_SSH_TERM=xterm-256color

# Connection Timeouts (milliseconds)
WEBSSH2_SSH_READY_TIMEOUT=20000
WEBSSH2_SSH_KEEPALIVE_INTERVAL=120000
WEBSSH2_SSH_KEEPALIVE_COUNT_MAX=10

# Local forwarding controls
WEBSSH2_SSH_LOCAL_ADDRESS=
WEBSSH2_SSH_LOCAL_PORT=

# Network access restrictions and auth behavior
WEBSSH2_SSH_ALLOWED_SUBNETS=
WEBSSH2_SSH_ALWAYS_SEND_KEYBOARD_INTERACTIVE=false
WEBSSH2_SSH_DISABLE_INTERACTIVE_AUTH=false
WEBSSH2_SSH_ENV_ALLOWLIST=

# SSH Algorithm Configuration
# Presets: modern, legacy, strict
WEBSSH2_SSH_ALGORITHMS_PRESET=modern

# Custom SSH Algorithms (when not using presets)
# WEBSSH2_SSH_ALGORITHMS_KEX=ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521
# WEBSSH2_SSH_ALGORITHMS_CIPHER=aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes128-ctr
# WEBSSH2_SSH_ALGORITHMS_HMAC=hmac-sha2-256,hmac-sha2-512
# WEBSSH2_SSH_ALGORITHMS_COMPRESS=none,zlib@openssh.com
# WEBSSH2_SSH_ALGORITHMS_SERVER_HOST_KEY=ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-rsa

# =============================================================================
# WebSSH2 Session Configuration
# =============================================================================

# Session Configuration
WEBSSH2_SESSION_NAME=webssh2.sid
WEBSSH2_SESSION_SECRET=your-secret-key-change-in-production-please

# =============================================================================
# WebSSH2 User Configuration
# =============================================================================

# Default user credentials (leave empty for dynamic authentication)
# WEBSSH2_USER_NAME=
# WEBSSH2_USER_PASSWORD=
# WEBSSH2_USER_PRIVATE_KEY=
# WEBSSH2_USER_PASSPHRASE=

# =============================================================================
# WebSSH2 Header Configuration
# =============================================================================

# Custom header text
WEBSSH2_HEADER_TEXT=NGINX + WebSSH2 with FIPS

# Header background color: green, blue, red, yellow, etc.
WEBSSH2_HEADER_BACKGROUND=green

# =============================================================================
# WebSSH2 Feature Options
# =============================================================================

# Enable challenge button for keyboard-interactive authentication
WEBSSH2_OPTIONS_CHALLENGE_BUTTON=true

# Enable automatic logging
WEBSSH2_OPTIONS_AUTO_LOG=false

# Allow re-authentication during session
WEBSSH2_OPTIONS_ALLOW_REAUTH=true

# Allow reconnection after disconnect
WEBSSH2_OPTIONS_ALLOW_RECONNECT=true

# Allow session replay
WEBSSH2_OPTIONS_ALLOW_REPLAY=true
WEBSSH2_OPTIONS_REPLAY_CRLF=false

# =============================================================================
# WebSSH2 Logging Configuration
# =============================================================================

# Structured logging controls
WEBSSH2_LOGGING_FORMAT=json
WEBSSH2_LOGGING_LEVEL=info
WEBSSH2_LOGGING_STDOUT_ENABLED=true
WEBSSH2_LOGGING_STDOUT_MIN_LEVEL=info

# Syslog transport (disabled by default)
WEBSSH2_LOGGING_SYSLOG_ENABLED=false
WEBSSH2_LOGGING_SYSLOG_HOST=
WEBSSH2_LOGGING_SYSLOG_PORT=6514
WEBSSH2_LOGGING_SYSLOG_APP_NAME=webssh2
WEBSSH2_LOGGING_SYSLOG_ENTERPRISE_ID=32473
WEBSSH2_LOGGING_SYSLOG_TLS_ENABLED=true
WEBSSH2_LOGGING_SYSLOG_TLS_CA_FILE=
WEBSSH2_LOGGING_SYSLOG_TLS_CERT_FILE=
WEBSSH2_LOGGING_SYSLOG_TLS_KEY_FILE=
WEBSSH2_LOGGING_SYSLOG_TLS_REJECT_UNAUTHORIZED=true
WEBSSH2_LOGGING_SYSLOG_BUFFER_SIZE=1000
WEBSSH2_LOGGING_SYSLOG_FLUSH_INTERVAL_MS=1000
WEBSSH2_LOGGING_SYSLOG_INCLUDE_JSON=false

# Advanced logging controls
WEBSSH2_LOGGING_SAMPLING_DEFAULT_RATE=1
WEBSSH2_LOGGING_SAMPLING_RULES=
WEBSSH2_LOGGING_RATE_LIMIT_RULES=

# =============================================================================
# WebSSH2 SSO Configuration
# =============================================================================

# Enable SSO functionality for enterprise authentication
WEBSSH2_SSO_ENABLED=false

# Enable CSRF protection for POST authentication requests
WEBSSH2_SSO_CSRF_PROTECTION=false

# Trusted proxy IP addresses for SSO (comma-separated, bypasses CSRF)
# Example: 10.0.0.1,192.168.1.100,172.16.0.0/12
WEBSSH2_SSO_TRUSTED_PROXIES=

# Header mapping for SSO credentials
# Configure these to match your SSO provider's headers
WEBSSH2_SSO_HEADER_USERNAME=x-apm-username
WEBSSH2_SSO_HEADER_PASSWORD=x-apm-password
WEBSSH2_SSO_HEADER_SESSION=x-apm-session

# =============================================================================
# WebSSH2 CORS Configuration
# =============================================================================

# Allowed origins for CORS (comma-separated)
# Leave empty to use auto-generated origins based on NGINX_SERVER_NAME
WEBSSH2_HTTP_ORIGINS=

# =============================================================================
# Legacy Configuration
# =============================================================================

# Legacy PORT variable (maps to WEBSSH2_LISTEN_PORT)
PORT=2222

# Debug output for WebSSH2 (uses debug npm package)
# Empty/unset: Minimal logging (errors only)
# 'webssh2:*': Enable all WebSSH2 debug output to /var/log/webssh2/webssh2.log
# Specific namespaces: 'webssh2:socket,webssh2:ssh,webssh2:config'
# Note: Debug output is written to both stdout and /var/log/webssh2/webssh2.log
DEBUG=

# =============================================================================
# Health Check Configuration
# =============================================================================

# Health check intervals
HEALTHCHECK_INTERVAL=30
HEALTHCHECK_TIMEOUT=5
HEALTHCHECK_RETRIES=3

# =============================================================================
# Example Production Configuration
# =============================================================================

# For production deployment, consider these settings:
#
# # Security
# TLS_MODE=provided
# FIPS_MODE=enabled
# FIPS_CHECK=true
# MTLS_ENABLED=true
# 
# # Performance
# NGINX_WORKER_PROCESSES=auto
# NGINX_WORKER_CONNECTIONS=2048
# NGINX_RATE_LIMIT=50r/s
# NGINX_RATE_LIMIT_BURST=100
# NGINX_CONN_LIMIT=500
#
# # Security Headers
# HSTS_MAX_AGE=31536000
# SECURITY_HEADERS=true
#
# # Session Security
# WEBSSH2_SESSION_SECRET=very-long-random-secret-generated-securely
#
# # Logging
# NGINX_ACCESS_LOG=on
# NGINX_ERROR_LOG_LEVEL=warn
#
# # SSH Security
# WEBSSH2_SSH_ALGORITHMS_PRESET=strict
# WEBSSH2_OPTIONS_AUTO_LOG=true

# =============================================================================
# Development Configuration
# =============================================================================

# For development, consider these settings:
#
# # Development ease
# TLS_MODE=self-signed
# FIPS_MODE=enabled
# FIPS_CHECK=false
# MTLS_ENABLED=false
#
# # Performance (lighter)
# NGINX_WORKER_PROCESSES=1
# NGINX_WORKER_CONNECTIONS=1024
# NGINX_RATE_LIMIT=100r/s
#
# # Debugging
# DEBUG=socket,ssh
# NGINX_ERROR_LOG_LEVEL=debug
# NGINX_ACCESS_LOG=on
#
# # CORS (permissive for development)
# WEBSSH2_HTTP_ORIGINS=https://localhost:443,https://127.0.0.1:443,https://webssh2.localhost:443
