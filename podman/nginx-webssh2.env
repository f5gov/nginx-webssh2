# NGINX + WebSSH2 Environment Configuration for RHEL/Podman
# Equivalent to docker-compose.yml environment section
# 
# Usage:
#   podman play kube --env-file nginx-webssh2.env nginx-webssh2-pod.yaml
#   systemctl --user start nginx-webssh2-pod
#
# IMPORTANT: Change default secrets and passwords for production use!

# ============================================================================
# TLS Configuration
# ============================================================================

# Certificate mode: self-signed, provided, letsencrypt
TLS_MODE=self-signed

# TLS protocols and cipher suites (FIPS-compliant by default)
TLS_PROTOCOLS="TLSv1.2 TLSv1.3"
TLS_CIPHERS="ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-GCM-SHA256"

# Self-signed certificate parameters
TLS_CERT_CN=webssh2.localhost
TLS_CERT_SAN="webssh2.localhost,localhost,127.0.0.1"

# Certificate paths (for provided mode)
# TLS_CERT_PATH=/etc/nginx/certs/cert.pem
# TLS_KEY_PATH=/etc/nginx/certs/key.pem
# TLS_CHAIN_PATH=/etc/nginx/certs/chain.pem

# Certificate content via environment (alternative to file paths)
# TLS_CERT_CONTENT="-----BEGIN CERTIFICATE-----..."
# TLS_KEY_CONTENT="-----BEGIN PRIVATE KEY-----..."

# ============================================================================
# mTLS Configuration (disabled by default)
# ============================================================================

MTLS_ENABLED=false
# MTLS_CA_CERT=/etc/nginx/certs/ca.pem
# MTLS_VERIFY_DEPTH=2
# MTLS_CRL_PATH=/etc/nginx/certs/ca.crl
# MTLS_OPTIONAL=false

# ============================================================================
# FIPS Configuration
# ============================================================================

# FIPS mode: enabled, disabled
FIPS_MODE=enabled

# FIPS validation (set to false for development environments)
FIPS_CHECK=false

# ============================================================================
# NGINX Configuration
# ============================================================================

# Server settings
NGINX_LISTEN_PORT=443
NGINX_SERVER_NAME=webssh2.localhost

# Worker configuration
NGINX_WORKER_PROCESSES=1
NGINX_WORKER_CONNECTIONS=1024

# Timeouts and limits
NGINX_KEEPALIVE_TIMEOUT=65
NGINX_CLIENT_MAX_BODY_SIZE=1m
NGINX_PROXY_READ_TIMEOUT=3600s
NGINX_PROXY_SEND_TIMEOUT=3600s

# Rate limiting and connection limits
NGINX_RATE_LIMIT=10r/s
NGINX_RATE_LIMIT_BURST=20
NGINX_CONN_LIMIT=100

# Performance settings
NGINX_GZIP=on

# Logging
NGINX_ACCESS_LOG=off
NGINX_ERROR_LOG_LEVEL=warn

# ============================================================================
# Security Headers
# ============================================================================

SECURITY_HEADERS=true
HSTS_MAX_AGE=31536000
CSP_POLICY="default-src 'self'; script-src 'self' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss:; font-src 'self'; img-src 'self' data:;"

# ============================================================================
# WebSSH2 Core Configuration
# ============================================================================

# WebSSH2 server binding
WEBSSH2_LISTEN_IP=127.0.0.1
WEBSSH2_LISTEN_PORT=2222

# ============================================================================
# WebSSH2 SSH Configuration
# ============================================================================

# SSH connection settings (empty SSH_HOST allows dynamic host selection)
WEBSSH2_SSH_HOST=""
WEBSSH2_SSH_PORT=22
WEBSSH2_SSH_TERM=xterm-256color

# SSH connection timeouts and keepalive
WEBSSH2_SSH_READY_TIMEOUT=20000
WEBSSH2_SSH_KEEPALIVE_INTERVAL=120000
WEBSSH2_SSH_KEEPALIVE_COUNT_MAX=10

# SSH algorithm settings
# Options: legacy, compat, default, modern, hardened
WEBSSH2_SSH_ALGORITHMS_PRESET=modern

# ============================================================================
# WebSSH2 Session Configuration
# ============================================================================

# Session management
WEBSSH2_SESSION_NAME=webssh2.sid

# IMPORTANT: Change this secret key for production!
WEBSSH2_SESSION_SECRET="your-secret-key-change-in-production"

# ============================================================================
# WebSSH2 Header Configuration
# ============================================================================

# Custom header text and styling
WEBSSH2_HEADER_TEXT="NGINX + WebSSH2 with FIPS"
WEBSSH2_HEADER_BACKGROUND=blue

# ============================================================================
# WebSSH2 Options
# ============================================================================

# Feature flags
WEBSSH2_OPTIONS_CHALLENGE_BUTTON=true
WEBSSH2_OPTIONS_AUTO_LOG=false
WEBSSH2_OPTIONS_ALLOW_REAUTH=true
WEBSSH2_OPTIONS_ALLOW_RECONNECT=true
WEBSSH2_OPTIONS_ALLOW_REPLAY=true

# ============================================================================
# WebSSH2 CORS Configuration
# ============================================================================

# Allowed origins for CORS (development setup)
WEBSSH2_HTTP_ORIGINS="https://webssh2.localhost:443,https://localhost:443,https://127.0.0.1:443"

# For production, restrict to specific domains:
# WEBSSH2_HTTP_ORIGINS="https://webssh2.example.com:443"

# ============================================================================
# Health Check Configuration
# ============================================================================

HEALTHCHECK_INTERVAL=30
HEALTHCHECK_TIMEOUT=5
HEALTHCHECK_RETRIES=3

# ============================================================================
# Legacy Environment Variables (for compatibility)
# ============================================================================

# Legacy port variable (some WebSSH2 versions may use this)
PORT=2222

# Debug mode (uncomment for troubleshooting)
# DEBUG=socket,ssh,config

# ============================================================================
# RHEL/Podman Specific Settings
# ============================================================================

# Container runtime settings
CONTAINER_LOG_LEVEL=warn

# SELinux context settings (if needed)
# SELINUX_CONTEXT=system_u:system_r:container_t:s0

# Podman network settings
# PODMAN_NETWORK_MODE=bridge

# ============================================================================
# Production Overrides
# ============================================================================
# For production deployment, create a separate .env.production file with:
#
# # Security
# TLS_MODE=provided
# FIPS_CHECK=true
# MTLS_ENABLED=true
# NGINX_SERVER_NAME=webssh2.example.com
#
# # Performance
# NGINX_WORKER_PROCESSES=auto
# NGINX_RATE_LIMIT=50r/s
# NGINX_CONN_LIMIT=500
# 
# # Logging
# NGINX_ACCESS_LOG=on
# NGINX_ERROR_LOG_LEVEL=error
#
# # CORS (restrict origins)
# WEBSSH2_HTTP_ORIGINS="https://webssh2.example.com:443"
#
# # Session security
# WEBSSH2_SESSION_SECRET="$(openssl rand -base64 32)"
# ============================================================================